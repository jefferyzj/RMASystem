{% extends "base.html" %}

{% block title %}Check-in For New{% endblock %}

{% block extra_head %}
<style>
    .hidden {
        display: none;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Display messages and handle redirection
        const messageContainer = document.querySelector('.messages');
        if (messageContainer && messageContainer.children.length > 0) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.classList.add(messageContainer.children[0].classList.contains('alert-success') ? 'toast-success' : 'toast-error');
            toast.innerHTML = messageContainer.children[0].innerHTML;
            document.body.appendChild(toast);
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
            // Hide the message container
            messageContainer.classList.add('hidden');
        }

        // Handle Enter key press to move to the next field
        const form = document.querySelector('form');
        const inputs = Array.from(form.querySelectorAll('input, select'));

        inputs.forEach((input, index) => {
            input.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const nextInput = inputs[index + 1];
                    if (nextInput) {
                        nextInput.focus();
                    }
                }
            });
        });
    });
</script>
{% endblock %}

{% block content %}
<h1>Check-in For New</h1>

<div id="message-container" class="hidden">
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>

<form method="post">
    {% csrf_token %}
    <div class="form-group">
        <label for="category">Category</label>
        {{ form.category }}
    </div>
    <div class="form-group">
        <label for="SNs">Serial Numbers (one per line)</label>
        {{ form.SNs }}
    </div>
    <div class="form-group">
        <label for="short_12V_48V">Short 12V/48V</label>
        {{ form.short_12V_48V }}
    </div>
    <div class="form-group">
        <label for="priority_level">Priority Level</label>
        {{ form.priority_level }}
    </div>
    <button type="submit" class="btn btn-primary" title="Check-in Product">Check-in Product</button>
</form>

<button onclick="window.location.href='{% url 'checkin' %}'" class="btn btn-secondary" title="Go back to Check-in">Go back to Check-in</button>
{% endblock %}