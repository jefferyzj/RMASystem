{% extends 'base.html' %}

{% block title %}Product List{% endblock %}

{% block content %}
<h2>Product List</h2>

<form method="get">
    <input type="text" name="search" placeholder="Search by SN" value="{{ request.GET.search }}">
    <select name="location">
        <option value="">All Locations</option>
        {% for location in locations %}
            <option value="{{ location.rack_name }}" {% if request.GET.location == location.rack_name %}selected{% endif %}>{{ location.rack_name }}</option>
        {% endfor %}
    </select>
    <select name="priority_level">
        <option value="">All Priority Levels</option>
        {% for level in priority_levels %}
            <option value="{{ level.0 }}" {% if request.GET.priority_level == level.0 %}selected{% endif %}>{{ level.1 }}</option>
        {% endfor %}
    </select>
    <select name="current_status">
        <option value="">All Statuses</option>
        {% for status in statuses %}
            <option value="{{ status.name }}" {% if request.GET.current_status == status.name %}selected{% endif %}>{{ status.name }}</option>
        {% endfor %}
    </select>
    <select name="current_task">
        <option value="">All Tasks</option>
        {% for task in tasks %}
            <option value="{{ task.action }}" {% if request.GET.current_task == task.action %}selected{% endif %}>{{ task.action }}</option>
        {% endfor %}
    </select>
    <button type="submit">Filter</button>
</form>

<h3>Filter by Category</h3>
<form method="get">
    {% for category in categories %}
        <input type="checkbox" name="category" value="{{ category.name }}" {% if category.name in request.GET.getlist('category') %}checked{% endif %}> {{ category.name }}<br>
    {% endfor %}
    <button type="submit">Apply Filter</button>
</form>

<table>
    <thead>
        <tr>
            <th>SN</th>
            <th>Category</th>
            <th>Location</th>
            <th>Priority Level</th>
            <th>Current Status</th>
            <th>Current Task</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for product in products %}
            <tr>
                <td>{{ product.SN }}</td>
                <td>{{ product.category.name }}</td>
                <td>{{ product.location.rack_name }}</td>
                <td>{{ product.get_priority_level_display }}</td>
                <td>{{ product.current_status.name }}</td>
                <td>{{ product.current_task.action }}</td>
                <td>
                    <a href="{% url 'product_detail' product.SN %}">Detail</a>
                    <a href="{% url 'product_status_task_edit' product.SN %}">Edit Status/Task</a>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<div class="pagination">
    {% if products.has_previous %}
        <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% for category in request.GET.getlist('category') %}category={{ category }}&{% endfor %}{% if request.GET.location %}location={{ request.GET.location }}&{% endif %}{% if request.GET.priority_level %}priority_level={{ request.GET.priority_level }}&{% endif %}{% if request.GET.current_status %}current_status={{ request.GET.current_status }}&{% endif %}{% if request.GET.current_task %}current_task={{ request.GET.current_task }}&{% endif %}page={{ products.previous_page_number }}">Previous</a>
    {% endif %}
    <span>Page {{ products.number }} of {{ products.paginator.num_pages }}</span>
    {% if products.has_next %}
        <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% for category in request.GET.getlist('category') %}category={{ category }}&{% endfor %}{% if request.GET.location %}location={{ request.GET.location }}&{% endif %}{% if request.GET.priority_level %}priority_level={{ request.GET.priority_level }}&{% endif %}{% if request.GET.current_status %}current_status={{ request.GET.current_status }}&{% endif %}{% if request.GET.current_task %}current_task={{ request.GET.current_task }}&{% endif %}page={{ products.next_page_number }}">Next</a>
    {% endif %}
</div>
{% endblock %}
